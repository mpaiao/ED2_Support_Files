#==========================================================================================#
#==========================================================================================#
#      This function calls the Tukey's Honest Significant Differences test, and determines #
#  the significantly different classes for each group, and assigns a letter for each       #
# distinct group.                                                                          #
#------------------------------------------------------------------------------------------#
tukey.classes <<- function(x,f,group=TRUE,alpha=0.05,...){
   #---------------------------------------------------------------------------------------#
   #     Check that x and f have the same length.                                          #
   #---------------------------------------------------------------------------------------#
   dummy = stopifnot(length(x) == length(f))
   #---------------------------------------------------------------------------------------#

   #----- Coerce f to factor. -------------------------------------------------------------#
   if (! is.factor(f)) f = as.factor(f)
   #---------------------------------------------------------------------------------------#


   #----- Create a data frame. ------------------------------------------------------------#
   xfdf = data.frame(x=x,f=f)
   #---------------------------------------------------------------------------------------#


   #----- Perform an analysis of variance test. -------------------------------------------#
   aovtest = aov(formula = x ~ f, data = xfdf,...)
   #---------------------------------------------------------------------------------------#


   #----- Perform the Post-hoc Tukey's Honest Significant Differences Test. ---------------#
   posthoc = HSD.test(aovtest,trt="f",group=group,alpha=alpha)
   #---------------------------------------------------------------------------------------#


   #----- Map classes onto the original levels. -------------------------------------------#
   trt.out  = as.character(posthoc$group$trt)
   lett.out = as.character(posthoc$group$M  )
   fout     = match(trt.out,levels(f))
   #---------------------------------------------------------------------------------------#



   #----- Save letters in the original order. ---------------------------------------------#
   ans        = character(nlevels(f))
   ans[fout]  = lett.out
   names(ans) = levels(f)
   #---------------------------------------------------------------------------------------#

   return(ans)
}#end tukey.classes
#==========================================================================================#
#==========================================================================================#
